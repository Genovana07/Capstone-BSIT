{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
<main class="main-section">
    <h2 class="tagline">Rent. <span>Set the Mood.</span></h2>
    <h1 class="main-heading">Make the Magic Happen.</h1>
    <p class="description">StudioFlow provides top-quality sound and lighting equipment for any event, big or small.</p>

    <a href="{% url 'services' %}">
        <button class="book-now">BOOK NOW</button>
    </a>
</main>

<div class="container">
    <div class="header">
        <span>Event Highlights</span>
    </div>

    <div class="gallery">
        {% for _ in "1234" %}
        <div class="item">
            <img src="{% static 'images/speaker1.jpg' %}" alt="Speaker" onclick="openLightbox(this.src)" style="cursor: zoom-in;">
            <p>Alto Speaker</p>
        </div>
        {% endfor %}
    </div>

    <button onclick="scrollToContainer1()" class="see-more-btn">
        See More
    </button>
</div>

<!-- Hidden Additional Gallery -->
 <div id="container1" class="container1" style="display: none;">
    <div class="title-container">
        <h2 class="title">Event Highlights</h2>
    </div>
    <div class="video-section">
        <video src="{% static 'videos/bg video.mp4' %}" controls autoplay muted></video>
    </div>
    <div class="gallery1">
        {% for _ in "1234567890" %}
        <div class="item1">
            <img src="{% static 'images/speaker1.jpg' %}" alt="Speaker" onclick="openLightbox(this.src)" style="cursor: zoom-in;">
            <p>Alto Speaker</p>
        </div>
        {% endfor %}
    </div>
</div>

<div class="testimonials-container">
  <h2 class="title">Testimonials <span class="line"></span></h2>
  <div class="carousel">
    <div class="cards" id="testimonial-cards">
      {% for i in "1234567890" %}
      <div class="card">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Testimonial #{{ forloop.counter }}</p>
        <div class="customer-info">
          <img src="{% static 'images/user-icon.png' %}" alt="User">
          <span>Customer {{ forloop.counter }}</span>
          <span class="rating">‚≠ê 4.9</span>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="dots">
    {% for i in "1234" %}
    <span class="dot{% if forloop.first %} active{% endif %}"></span>
    {% endfor %}
  </div>
</div>

<!-- Improved FAQ Section -->
<div class="faq-container">
  <div class="faq-content">
    <h2 class="title">FAQs <span class="line"></span></h2>
    <p>Got questions? We've got answers.</p>
    <div class="faq-list">
      {% for _ in "123" %}
      <details>
        <summary>What services do you offer?</summary>
        <p>We provide premium sound and lighting equipment rental, setup, and event production services.</p>
      </details>
      {% endfor %}
    </div>
  </div>
  <div class="faq-image">
    <img src="{% static 'images/speaker1.jpg' %}" alt="FAQ Illustration" onclick="openLightbox(this.src)" style="cursor: zoom-in;">
  </div>
</div>

<!-- Lightbox Modal -->
<div id="lightbox-modal" onclick="closeLightbox()" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:9999;">
    <img id="lightbox-img">
    <span onclick="closeLightbox()" style="position:absolute;top:20px;right:30px;font-size:2rem;color:white;cursor:pointer;">&times;</span>
</div>
<!-- Toggle Button -->
<div id="chat-toggle" 
     style="position: fixed; bottom: 20px; right: 20px; 
            background: #0078d7; color: white; padding: 12px 16px; 
            border-radius: 50%; cursor: pointer; z-index:10000;">
    üí¨
</div>
<div class="chatbot-container">
    <!-- Header -->
    <div class="chatbot-header">
        <h2>Booking Chatbot ü§ñ</h2>
        <p>Ask about available booking dates easily</p>
    </div>

    <!-- Chat Messages -->
    <div id="chat-box" class="chatbot-messages">
        <div class="chat-placeholder">Start asking a question...</div>
    </div>

    <!-- Input -->
    <div class="chatbot-input">
        <input id="chat-input" 
               type="text" 
               placeholder="Type your question here... (e.g., Available ba ang 2025-08-20?)">
        <button id="send-btn">Send</button>
    </div>

    <!-- Guide -->
    <div class="chatbot-guide">
        <h3>üìå Guide: How to Ask</h3>
        <ul>
            <li>Para mag-check ng date: <b>Available ba ang YYYY-MM-DD?</b></li>
            <li>Halimbawa: <i>"Available ba ang 2025-08-20?"</i></li>
            <li>Kung mali ang format ng date ‚Üí gagabayan ka ng bot.</li>
        </ul>
    </div>
</div>
<footer class="footer">
    <div class="logo">
        <span style="color: white; font-weight: bold; font-size: 1.5rem;">AUDIO</span><span style="background-color: #f1c40f; color: black; font-weight: bold; padding: 2px 6px; margin-left: 4px; border-radius: 3px; font-size: 1.5rem;">MAN</span><br>
        <small style="color: white; text-transform: uppercase; font-weight: 600; letter-spacing: 1px;">Lights & Sounds</small>
        <div style="font-size: 0.7rem; color: #ddd; margin-top: 10px; text-transform: uppercase;">Owned and Operated by: Audioman Events and Entertainment Corp.</div>
    </div>
    <div class="column">
        <h3>Services</h3>
        <p>Sound System Rental</p>
        <p>Lighting Design</p>
        <p>Event Production</p>
    </div>
    <div class="column">
        <h3>Company</h3>
        <p>About Us</p>
        <p>Careers</p>
        <p>Blog</p>
    </div>
    <div class="column">
        <h3>Contact Us</h3>
        <p>info@studioflow.com</p>
        <p>+63 912 345 6789</p>
    </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const chatbot = document.querySelector(".chatbot-container");
    const toggle = document.getElementById("chat-toggle");

    // default: hidden
    chatbot.style.display = "none";

    toggle.addEventListener("click", function () {
        chatbot.style.display = (chatbot.style.display === "none") ? "flex" : "none";
    });
});

function appendMessage(sender, message) {
    const log = document.getElementById("chat-log");
    const div = document.createElement("div");
    div.textContent = sender + ": " + message;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
}

document.getElementById("send-btn").addEventListener("click", sendMessage);
document.getElementById("chat-input").addEventListener("keypress", function(e) {
    if (e.key === "Enter") sendMessage();
});

function sendMessage() {
    let input = document.getElementById("chat-input");
    let message = input.value.trim();
    if (message === "") return;

    // Add user message to chatbox
    let chatBox = document.getElementById("chat-box");
    let userMsg = document.createElement("div");
    userMsg.className = "text-right";
    userMsg.innerHTML = `<span class="inline-block bg-blue-500 text-white px-3 py-2 rounded-lg mb-2">${message}</span>`;
    chatBox.appendChild(userMsg);

    // Scroll down
    chatBox.scrollTop = chatBox.scrollHeight;

    // Clear input
    input.value = "";

    // Send to API
    fetch(`/accounts/chatbot-api/?message=${encodeURIComponent(message)}`)
        .then(res => res.json())
        .then(data => {
            let botMsg = document.createElement("div");
            botMsg.className = "text-left";
            botMsg.innerHTML = `<span class="inline-block bg-gray-200 text-gray-800 px-3 py-2 rounded-lg mb-2">${data.response}</span>`;
            chatBox.appendChild(botMsg);
            chatBox.scrollTop = chatBox.scrollHeight;
        });
}
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
// CSRF token helper
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
    const cookies = document.cookie.split(";");
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.substring(0, name.length + 1) === (name + "=")) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
    function scrollToContainer1() {
        var container = document.getElementById("container1");
        container.style.display = "block";
        container.scrollIntoView({ behavior: "smooth" });
    }

    function openLightbox(src) {
        const modal = document.getElementById("lightbox-modal");
        const img = document.getElementById("lightbox-img");
        img.src = src;
        img.style.width = '100%';
        img.style.height = 'auto';
        modal.style.display = "flex";
    }

    function closeLightbox() {
        document.getElementById("lightbox-modal").style.display = "none";
    }

    let currentIndex = 0;
    function moveCarousel(direction) {
        const cards = document.getElementById("testimonial-cards").children;
        const totalCards = cards.length;
        currentIndex = (currentIndex + direction + totalCards) % totalCards;
        const cardWidth = cards[0].offsetWidth;
        document.getElementById("testimonial-cards").style.transform = `translateX(-${cardWidth * currentIndex}px)`;
    }
</script>
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}
