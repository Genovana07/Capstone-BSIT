{% extends 'client-base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
/* ---------- Global Styling ---------- */
h1 {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 20px;
    color: #333;
}

/* ---------- Light Mode (Default) ---------- */
.review-summary {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: #ffffff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    margin: 30px 0;
    flex-wrap: wrap;
    gap: 25px;
    text-align: center;
}

.divider {
    width: 2px;
    height: 60px;
    background-color: #e0e0e0;
    margin: 0 25px;
}

.review-count h2,
.average-rating h2,
.metrics-summary h2 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 10px;
    color: #444;
}

.review-number,
.rating-number {
    font-size: 32px;
    font-weight: 900;
    color: #222;
}

.metrics-summary ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.metrics-summary li {
    font-size: 14px;
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px dashed #ddd;
    color: #666;
}

.metrics-summary li:last-child {
    border-bottom: none;
}

/* Reviews list with scroll */
.reviews-list {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-height: 700px;
    overflow-y: auto;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

.reviews-list::-webkit-scrollbar {
    width: 8px;
}
.reviews-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 12px;
}
.reviews-list::-webkit-scrollbar-thumb {
    background-color: #bbb;
    border-radius: 12px;
}

/* Review Card */
.review-card {
    display: flex;
    padding: 18px;
    border: 1px solid #eee;
    border-radius: 12px;
    background: #fafafa;
    align-items: flex-start;
    gap: 20px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
}
.review-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
}

.reviewer-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ddd;
}

.review-details {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.review-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.review-header strong {
    font-size: 16px;
    font-weight: 700;
    color: #222;
}

.review-header span {
    font-size: 14px;
    color: #666;
}

.review-header .date {
    margin-left: auto;
    font-size: 12px;
    color: #999;
}

/* ---------- STAR RATING ---------- */
.stars {
    display: flex;
    gap: 3px;
    font-size: 16px;
}

.stars .filled {
    color: #f5b50a; /* Yellow for filled stars */
}

.stars .empty {
    color: #ddd; /* Light gray for empty stars */
}

body.dark-mode .stars .empty {
    color: #555; /* Darker gray for dark mode */
}

/* ---------- Metrics Section ---------- */
.metrics {
    margin: 12px 0;
}
.metrics li {
    font-size: 14px;
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    color: #444;
}

.review-details p {
    font-size: 15px;
    line-height: 1.6;
    color: #333;
    margin-top: 6px;
}

/* ---------- Date Filter Styling ---------- */
.date-filter {
    display: flex;
    gap: 12px;
    align-items: center;
    position: relative; /* changed from fixed */
    margin: 20px 0;
    padding: 10px 20px;
    border-radius: 10px;
    background: #ffffff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    width: fit-content;
}

.date-filter label {
    font-size: 14px;
    font-weight: 500;
    color: #444;
}

.date-filter select {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    color: #333;
}

.date-filter button {
    padding: 8px 16px;
    font-size: 14px;
    background-color: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
}
.date-filter button:hover {
    background-color: #1d4ed8;
}

/* ---------- Dark Mode ---------- */
body.dark-mode .review-summary {
    background: #2e2e2e;
    color: #e0e0e0;
    border: none;
    box-shadow: 0 6px 15px rgba(0,0,0,0.6);
}
body.dark-mode .divider {
    background-color: #555;
}
body.dark-mode .review-number,
body.dark-mode .rating-number {
    color: #fff;
}
body.dark-mode .metrics-summary li {
    border-bottom: 1px dashed #666;
    color: #ccc;
}
body.dark-mode .reviews-list {
    background: #2c2f38;
    color: #e0e0e0;
}
body.dark-mode .review-card {
    background: #3a3d47;
    border: 1px solid #555;
}
body.dark-mode .review-header strong {
    color: #fff;
}
body.dark-mode .review-header span,
body.dark-mode .review-header .date {
    color: #aaa;
}
body.dark-mode .metrics li {
    color: #ddd;
}
body.dark-mode .date-filter {
    background: #3a3d47;
    border: 1px solid #555;
}
body.dark-mode .date-filter select {
    background: #2e2e2e;
    color: #eee;
    border: 1px solid #666;
}
body.dark-mode .date-filter button {
    background-color: #2563eb;
}
body.dark-mode .date-filter button:hover {
    background-color: #1d4ed8;
}
</style>

<!-- Filter Section (Top Only, Not Sticky) -->
<div class="date-filter">
    <form method="get">
        <label for="filter_day">Day:</label>
        <select id="filter_day" name="filter_day">
            <option value="">All</option>
            {% for day in days %}
                <option value="{{ day }}" {% if day == request.GET.filter_day %}selected{% endif %}>{{ day }}</option>
            {% endfor %}
        </select>

        <label for="filter_month">Month:</label>
        <select id="filter_month" name="filter_month">
            <option value="">All</option>
            {% for value, month in months %}
                <option value="{{ value }}" {% if value == request.GET.filter_month %}selected{% endif %}>{{ month }}</option>
            {% endfor %}
        </select>

        <label for="filter_year">Year:</label>
        <select id="filter_year" name="filter_year">
            <option value="">All</option>
            {% for year in years %}
                <option value="{{ year }}" {% if year == request.GET.filter_year %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>
</div>

<!-- Review Summary -->
<div class="review-summary">
    <div class="review-count">
        <h2>Reviews</h2>
        <p class="review-number">{{ reviews.count }}</p>
        <p class="review-label">Total Reviews</p>
    </div>
    <div class="divider"></div>

    <div class="average-rating">
        <h2>Average Rating</h2>
        <div class="rating-number">
            {{ average_rating|default:"0" }} ★
        </div>
        <p>Overall Satisfaction</p>
    </div>

    <div class="metrics-summary">
        <h2>Average Metrics</h2>
        <ul>
            <li>Quality: <span>{{ avg_quality|default:"0" }} ★</span></li>
            <li>Timeliness: <span>{{ avg_timeliness|default:"0" }} ★</span></li>
            <li>Professionalism: <span>{{ avg_professionalism|default:"0" }} ★</span></li>
            <li>Value for Money: <span>{{ avg_value_for_money|default:"0" }} ★</span></li>
        </ul>
    </div>
</div>

<!-- Reviews List -->
<div class="reviews-list">
    {% for review in reviews %}
    <div class="review-card">
        <img src="{% if review.booking.customer.profile_picture %}{{ review.booking.customer.profile_picture.url }}{% else %}{% static 'images/profile-icon.png' %}{% endif %}" 
             alt="Reviewer" class="reviewer-avatar">
        <div class="review-details">
            <div class="review-header">
                <strong>{{ review.customer_name }}</strong>
                <span>{{ review.event_type }}</span>
                
                <!-- ⭐ Star Rating -->
                <span class="stars">
                    {% for i in "12345" %}
                        {% if forloop.counter <= review.rating %}
                            <i class="fa-solid fa-star filled"></i>
                        {% else %}
                            <i class="fa-solid fa-star empty"></i>
                        {% endif %}
                    {% endfor %}
                </span>

                <span class="date">Booked on {{ review.booking_date|date:"M d, Y" }}</span>
            </div>

            <ul class="metrics">
                <li>Quality: <span>{{ review.quality }} ★</span></li>
                <li>Timeliness: <span>{{ review.timeliness }} ★</span></li>
                <li>Professionalism: <span>{{ review.professionalism }} ★</span></li>
                <li>Value for Money: <span>{{ review.value_for_money }} ★</span></li>
            </ul>

            <p>{{ review.comment }}</p>
        </div>
    </div>
    {% empty %}
    <p>No reviews yet.</p>
    {% endfor %}
</div>

{% endblock %}
